<head>
    <link rel="stylesheet" href="~/css/Game.css" asp-append-version="true" />
</head>

@{
    int aantalSpelers = 0;
    //gameModel gekozenSpel = (gameModel)ViewData["gekozenSpel"];
    //int gekozenSpelID = (int)ViewData["gekozenSpelID"];
    int userID = 12;
    int gewonnen = 1;
    ViewData["Title"] = "Game";
}



<div class="gridder">
    <div class="container">
        @Html.Partial("Navbar")


        <div class="game-wrapper">
            <h2 class="game-name">@Model.name</h2>
            <p>@Model.rules</p>
            <div class="game-players">
                <p class="game-usercount">Aantal spelers: <span id="connected-players">0</span>/@Model.minimum_players</p>
                <ul id="players" class="game-players-ul">
                    @for (int i = 0; i < 6; i++)
                    {
                        <li class="game-players-li">
                            Open
                        </li>
                    }
                </ul>

            <div class="buttons-container">
                    <button value="Invite Player" class="btn modal-toggle" onclick="ToggleInviteModal(this)">Invite Players</button>
                    <button value="Leave Game" class="btn" id="start-button">Start Game</button>
            </div>
            </div>
        </div>
    </div>
</div>


<div class="modal hidden">
    <div class="modal-content">
        <span class="close" onclick="ToggleInviteModal(this)">&times;</span>
        <h2 style="color: black">Invite</h2>
        <select class="accountlist" size="13" multiple>
           
        </select>
        <button class="btn" onclick="SendInvite()">Invite Players</button>
    </div>
</div>



@section scripts{
    <script src="~/js/signalr/dist/browser/signalr.js"></script>
    <script src="~/js/lobby.js"></script>
    <script>

        function SendInvite(){
            var selected = $('.accountlist').val();
            console.log(selected);
            $.ajax({
                url: '/Game/SendInvite',
                data: JSON.stringify(selected),
                type: 'POST',
                contentType: 'application/json',
                success: function (res) {
                    console.log(res)
                    const modal = document.querySelector('.modal');
                    modal.classList.toggle('hidden');
                    toastr.success(`Invite sent to ${selected}!`);



                },
                error: function (error) {
                    console.log(error)
                }
            });

        }

        function ToggleInviteModal(activator){
            console.log(activator);
            const modal = document.querySelector('.modal');
            const accountlist = document.querySelector('.accountlist');

            modal.classList.toggle('hidden');
            if(activator.classList.contains("modal-toggle")){
            
                $.ajax({
                    url: '/Game/GetAccounts',
                    type: 'GET',
                    contentType: 'application/json',
                    success: function (res) {
                        accountlist.innerHTML = "";
                        
                        res.map(e => {
                            var opt = document.createElement("option");
                            opt.className = "account";
                            opt.innerHTML = e.email;
                           
                            accountlist.appendChild(opt);
                        })
                        
                    },
                    error: function (error) {
                        console.log(error)
                    }
                });
            }
        }
      
        function mode() {
            var val = document.getElementById("mode").value;
            aantalTeams = document.getElementById("aantalTeams");

            if(val == "team"){
                aantalTeams.innerHTML = `<label>Aantal teams:</label>
                                        <input onchange="teams()" id="aantalTeams" type="number" name="aantalTeams" min="2">
                                        <br>
                                        <br>`
            } else {
                aantalTeams.innerHTML = ""
            }
        }

        function teams(){
            aantalTeams = document.getElementsByName("aantalTeams")[0].value;
        }

        function sendData(gameID, userID){
            var spelers = [];
            for (var i = 0; i < document.getElementsByName("aantalSpelers").length; i++){
                spelers.push(document.getElementsByName("aantalSpelers")[i].value)
            }

            spelers1 = spelers.join(',');

            $.ajax({
                url: '/Main/sendData',
                data: { Game_ID: gameID, User_ID: userID, User_IDs: spelers1},
                type: 'GET',
                success: function (returned_data) {
                    //console.log(returned_data)
                    location.href = "wedstrijd?ID=" + returned_data
                },
                error: function (returned_data) {
                    console.log(returned_data)
                }   
            });
        }

        function increaseValue() {
            var value = parseInt(document.getElementById('number').value, 10);
            value = isNaN(value) ? 0 : value;
            value++;
            document.getElementById('number').value = value;

            test.innerHTML += `<input id="te" type="text" name="aantalSpelers">`
        }

        function decreaseValue() {
            var value = parseInt(document.getElementById('number').value, 10);
            value = isNaN(value) ? 0 : value;
            value < 3 ? value = 3 : '';
            value--;
            document.getElementById('number').value = value;

            test.innerHTML = ``

            for(let i = 0; i < value; i++){
                test.innerHTML += `<input id="te" type="text" name="aantalSpelers">`
            }

        }

    </script>
}
